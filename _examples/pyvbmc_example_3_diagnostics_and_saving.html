
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PyVBMC Example 3: Output diagnostics and saving results &#8212; PyVBMC</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://acerbilab.github.io/pyvbmc/_examples/pyvbmc_example_3_diagnostics_and_saving.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PyVBMC Example 4: Multiple runs as validation" href="pyvbmc_example_4_validation.html" />
    <link rel="prev" title="PyVBMC Example 2: Understanding the inputs and the output trace" href="pyvbmc_example_2_inputs_outputs.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../quickstart.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../examples.html">
   Examples
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="pyvbmc_example_1_basic_usage.html">
     PyVBMC Example 1: Basic usage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyvbmc_example_2_inputs_outputs.html">
     PyVBMC Example 2: Understanding the inputs and the output trace
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     PyVBMC Example 3: Output diagnostics and saving results
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyvbmc_example_4_validation.html">
     PyVBMC Example 4: Multiple runs as validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyvbmc_example_5_prior_distributions.html">
     PyVBMC Example 5: Prior distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyvbmc_example_6_noisy_likelihoods.html">
     PyVBMC Example 6: Noisy log-likelihood evaluations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../documentation.html">
   Documentation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/vbmc.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       VBMC
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/variational_posterior.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       VariationalPosterior
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/options/vbmc_options.html">
     VBMC options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/priors.html">
     Priors
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/advanced_docs.html">
     Advanced documentation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/classes/classes.html">
       Classes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/classes/acquisition_functions.html">
         Acquisition Functions
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/classes/function_logger.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           FunctionLogger
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/classes/iteration_history.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           IterationHistory
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/classes/options.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           Options
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/classes/parameter_transformer.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           ParameterTransformer
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/classes/timer.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           Timer
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/classes/variational_posterior.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           VariationalPosterior
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/classes/vbmc.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           VBMC
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/functions/functions.html">
       Functions
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/functions/active_sample.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           active_sample
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/functions/create_vbmc_animation.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           create_vbmc_animation
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/functions/decorators.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           decorators
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/functions/entropy.html">
         Entropy
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/functions/get_hpd.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           get_hpd
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/functions/kde_1d.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           kde_1d
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/functions/whitening.html">
         <code class="docutils literal notranslate">
          <span class="pre">
           whitening
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/options/vbmc_options.html">
       VBMC options
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../development.html">
   Instructions for developers and contributors
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../about_us.html">
   About us
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/acerbilab/pyvbmc/main?urlpath=lab/tree/_examples/pyvbmc_example_3_diagnostics_and_saving.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/acerbilab/pyvbmc/blob/main/_examples/pyvbmc_example_3_diagnostics_and_saving.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/acerbilab/pyvbmc"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/acerbilab/pyvbmc/issues/new?title=Issue%20on%20page%20%2F_examples/pyvbmc_example_3_diagnostics_and_saving.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/acerbilab/pyvbmc/edit/main/_examples/pyvbmc_example_3_diagnostics_and_saving.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/_examples/pyvbmc_example_3_diagnostics_and_saving.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-definition-and-setup">
   1. Model definition and setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-model-and-checking-convergence-diagnostics">
   2. Running the model and checking convergence diagnostics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-results">
   3. Saving results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resume-the-optimization-process">
   4. Resume the optimization process
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusions">
   5. Conclusions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acknowledgments">
   Acknowledgments
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>PyVBMC Example 3: Output diagnostics and saving results</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-definition-and-setup">
   1. Model definition and setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-model-and-checking-convergence-diagnostics">
   2. Running the model and checking convergence diagnostics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-results">
   3. Saving results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resume-the-optimization-process">
   4. Resume the optimization process
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusions">
   5. Conclusions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acknowledgments">
   Acknowledgments
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="pyvbmc-example-3-output-diagnostics-and-saving-results">
<h1>PyVBMC Example 3: Output diagnostics and saving results<a class="headerlink" href="#pyvbmc-example-3-output-diagnostics-and-saving-results" title="Permalink to this headline">#</a></h1>
<p>In this notebook, we demonstrate extended usage of PyVBMC. We will take a brief look at PyVBMC’s diagnostic output, and show you how to save the results of optimization to disk.</p>
<p>This notebook is Part 3 of a series of notebooks in which we present various example usages for VBMC with the PyVBMC package. The code used in this example is available as a script <a class="reference external" href="https://github.com/acerbilab/pyvbmc/blob/main/examples/scripts/pyvbmc_example_3_full_code.py">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">scs</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">pyvbmc</span> <span class="kn">import</span> <span class="n">VBMC</span>
<span class="kn">from</span> <span class="nn">pyvbmc.formatting</span> <span class="kn">import</span> <span class="n">format_dict</span>
<span class="kn">import</span> <span class="nn">dill</span>
</pre></div>
</div>
</div>
</div>
<section id="model-definition-and-setup">
<h2>1. Model definition and setup<a class="headerlink" href="#model-definition-and-setup" title="Permalink to this headline">#</a></h2>
<p>For demonstration purposes, we will run PyVBMC with a restricted budget of function evaluations, insufficient to achieve convergence. Then we will inspect the output diagnostics, and resume optimization.</p>
<p>We use a higher-dimensional analogue of the same toy target function in Example 1, a broad <a class="reference external" href="https://en.wikipedia.org/wiki/Rosenbrock_function">Rosenbrock’s banana function</a> in <span class="math notranslate nohighlight">\(D = 4\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># A four-dimensional problem</span>
<span class="n">prior_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="n">prior_var</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">log_prior</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multivariate normal prior on theta.&quot;&quot;&quot;</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">prior_var</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scs</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">prior_mu</span><span class="p">,</span> <span class="n">cov</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The likelihood function of your model will in general depend on the observed data. This data can be fixed as a global variable, as we did directly above for <code class="docutils literal notranslate"><span class="pre">prior_mu</span></code> and <code class="docutils literal notranslate"><span class="pre">prior_var</span></code>. It can also be defined by a default second argument: to PyVBMC there is no difference so long as the function can be called with only a single argument (the parameters <code class="docutils literal notranslate"><span class="pre">theta</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">D</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;D-dimensional Rosenbrock&#39;s banana function.&quot;&quot;&quot;</span>
    <span class="c1"># In this simple demo the data just translates the parameters:</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">data</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">theta</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">log_joint</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">D</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;log-density of the joint distribution.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">log_likelihood</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">log_prior</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>  <span class="c1"># Lower bounds</span>
<span class="n">UB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>  <span class="c1"># Upper bounds</span>
<span class="n">PLB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">prior_mu</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">prior_var</span><span class="p">))</span>  <span class="c1"># Plausible lower bounds</span>
<span class="n">PUB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">prior_mu</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">prior_var</span><span class="p">))</span>  <span class="c1"># Plausible upper bounds</span>
</pre></div>
</div>
</div>
</div>
<p>In a typical inference scenario, we recommend starting from a “good” point (i.e. one near the mode). We can run a  quick preliminary optimization, though a more extensive optimization would not harm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">41</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">PLB</span><span class="p">,</span> <span class="n">PUB</span><span class="p">)</span>  <span class="c1"># Random point inside plausible box</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="o">-</span><span class="n">log_joint</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
    <span class="n">x0</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">x</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Limit number of function evaluations</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_fun_evals&quot;</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">D</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1"># We can specify either the log-joint, or the log-likelihood and log-prior.</span>
<span class="c1"># In other words, the following lines are equivalent:</span>
<span class="n">vbmc</span> <span class="o">=</span> <span class="n">VBMC</span><span class="p">(</span>
    <span class="n">log_likelihood</span><span class="p">,</span>
    <span class="n">x0</span><span class="p">,</span>
    <span class="n">LB</span><span class="p">,</span>
    <span class="n">UB</span><span class="p">,</span>
    <span class="n">PLB</span><span class="p">,</span>
    <span class="n">PUB</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
    <span class="n">log_prior</span><span class="o">=</span><span class="n">log_prior</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># vbmc = VBMC(</span>
<span class="c1">#     log_joint,</span>
<span class="c1">#     x0, LB, UB, PLB, PUB, options=options,</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reshaping x0 to row vector.
Reshaping lower bounds to (1, 4).
Reshaping upper bounds to (1, 4).
Reshaping plausible lower bounds to (1, 4).
Reshaping plausible upper bounds to (1, 4).
</pre></div>
</div>
</div>
</div>
<p>(PyVBMC expects the bounds to be <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">D)</span></code> row vectors, and the initial point(s) to be of shape <code class="docutils literal notranslate"><span class="pre">(n,</span> <span class="pre">D)</span></code>, but it will accept and re-shape vectors of shape <code class="docutils literal notranslate"><span class="pre">(D,)</span></code> as well.)</p>
</section>
<section id="running-the-model-and-checking-convergence-diagnostics">
<h2>2. Running the model and checking convergence diagnostics<a class="headerlink" href="#running-the-model-and-checking-convergence-diagnostics" title="Permalink to this headline">#</a></h2>
<p>Now we run PyVBMC with a very small budget of 40 function evaluations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vp</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Beginning variational optimization assuming EXACT observations of the log-joint.
 Iteration  f-count    Mean[ELBO]    Std[ELBO]    sKL-iter[q]   K[q]  Convergence  Action
     0         10          -3.64         1.20    230538.53        2        inf     start warm-up
     1         15          -3.40         2.05        15.56        2        inf     
     2         20          -3.42         2.08        14.12        2        242     
     3         25          35.04        70.57      2305.69        2   3.88e+04     
     4         30          39.27        71.14      4950.88        2   8.28e+04     trim data
     5         35          -3.39         1.05       227.02        2   3.93e+03     
     6         40           3.33        12.07        27.91        2        528     
   inf         40          -3.13         1.00         0.20       50   3.93e+03     finalize
Inference terminated: reached maximum number of function evaluations options.max_fun_evals.
Estimated ELBO: -3.130 +/-0.995.
Caution: Returned variational solution may have not converged.
</pre></div>
</div>
</div>
</div>
<p>PyVBMC is warning us that convergence is doubtful. We can look at the output for more information and diagnostics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;success_flag&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">False</span></code> means that PyVBMC has not converged to a stable solution within the given number of function evaluations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">format_dict</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    &#39;function&#39;: &#39;&lt;function VBMC._init_log_joint.&lt;locals&gt;.log_joint at 0x7f71a5e22310&gt;&#39;,
    &#39;problem_type&#39;: &#39;unconstrained&#39;,
    &#39;iterations&#39;: 6,
    &#39;func_count&#39;: 40,
    &#39;best_iter&#39;: 5,
    &#39;train_set_size&#39;: 31,
    &#39;components&#39;: 50,
    &#39;r_index&#39;: 3929.341498249543,
    &#39;convergence_status&#39;: &#39;no&#39;,
    &#39;overhead&#39;: nan,
    &#39;rng_state&#39;: &#39;rng&#39;,
    &#39;algorithm&#39;: &#39;Variational Bayesian Monte Carlo&#39;,
    &#39;version&#39;: &#39;0.1.0&#39;,
    &#39;message&#39;: &#39;Inference terminated: reached maximum number of function evaluations options.max_fun_evals.&#39;,
    &#39;elbo&#39;: -3.129758475814559,
    &#39;elbo_sd&#39;: 0.995262203269921,
    &#39;success_flag&#39;: False,
}
</pre></div>
</div>
</div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">info</span></code> dictionary:</p>
<ul class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">convergence_status</span></code> field says ‘no’ (probable lack of convergence);</p></li>
<li><p>the reliability index <code class="docutils literal notranslate"><span class="pre">r_index</span></code> is 3.68, (should be less than 1).
Our diagnostics tell us that this run has not converged, suggesting to increase the budget.</p></li>
</ul>
<p>Note that convergence to a solution does not mean that it is a <em>good</em> solution. You should always check the returned variational posteriors, and ideally should compare across multiple runs of PyVBMC.</p>
</section>
<section id="saving-results">
<h2>3. Saving results<a class="headerlink" href="#saving-results" title="Permalink to this headline">#</a></h2>
<p>We can also save the <code class="docutils literal notranslate"><span class="pre">VBMC</span></code> instance to disk and reload it later, in order to check the results and convergence diagnostics, sample from the posterior, or resume the optimization from checkpoint etc. If you are only interested in the final (best) variational solution, as opposed to the full iteration history of the optimization, then you may wish to pickle only the final <code class="docutils literal notranslate"><span class="pre">VariationalPosterior</span></code> instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;vbmc_test_save.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">vbmc</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;vbmc_test_save.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">vbmc</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="resume-the-optimization-process">
<h2>4. Resume the optimization process<a class="headerlink" href="#resume-the-optimization-process" title="Permalink to this headline">#</a></h2>
<p>Now we could resume the optimization process of PyVBMC by increasing maximum number of function evaluations. This default is <span class="math notranslate nohighlight">\(50(d+2)\)</span>, where <span class="math notranslate nohighlight">\(d\)</span> is the dimension of the parameter space (though this example will not use the full budget):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iteration</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration</span>
<span class="p">)</span>  <span class="c1"># continue from specified iteration, here it&#39;s the last iteration</span>
<span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">iteration</span> <span class="o">&lt;=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration</span>

<span class="c1">## Set states for VBMC right before the specified iteration</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">gp</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration_history</span><span class="p">[</span><span class="s2">&quot;gp&quot;</span><span class="p">][</span><span class="n">iteration</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration_history</span><span class="p">[</span><span class="s2">&quot;vp&quot;</span><span class="p">][</span><span class="n">iteration</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">function_logger</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration_history</span><span class="p">[</span><span class="s2">&quot;function_logger&quot;</span><span class="p">][</span><span class="n">iteration</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">optim_state</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration_history</span><span class="p">[</span><span class="s2">&quot;optim_state&quot;</span><span class="p">][</span><span class="n">iteration</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">hyp_dict</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">optim_state</span><span class="p">[</span><span class="s2">&quot;hyp_dict&quot;</span><span class="p">]</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration_history</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration_history</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration_history</span><span class="p">[</span><span class="n">k</span><span class="p">][:</span><span class="n">iteration</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="c1"># (Optionally) Set random state for reproducibility, note that it can only</span>
<span class="c1"># reproduce exactly the same optimization process when VBMC&#39;s options are not updated</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">iteration_history</span><span class="p">[</span><span class="s2">&quot;random_state&quot;</span><span class="p">][</span><span class="n">iteration</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We need to update the options. Here we increase <code class="docutils literal notranslate"><span class="pre">max_fun_evals</span></code> and resume the optimization process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_fun_evals&quot;</span><span class="p">:</span> <span class="mi">50</span> <span class="o">*</span> <span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="p">(</span>
    <span class="kc">False</span>  <span class="c1"># Temporarily set to False for updating options</span>
<span class="p">)</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
<span class="n">vbmc</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">vbmc</span><span class="o">.</span><span class="n">is_finished</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">vp</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Beginning variational optimization assuming EXACT observations of the log-joint.
 Iteration  f-count    Mean[ELBO]    Std[ELBO]    sKL-iter[q]   K[q]  Convergence  Action
     6         40           7.20        10.74        24.78        2        484     
     7         45           6.46        33.89        19.32        2        437     
     8         50          -5.04         0.20        15.45        2        296     end warm-up
     9         55          -4.83         0.13         0.30        2       6.17     
    10         60          -4.78         0.15         0.11        2       2.52     
    11         65          -4.76         0.06         0.03        3      0.738     
    12         70          -4.55         0.03         0.08        6       2.09     
    13         75          -4.38         0.02         0.05        7        1.4     rotoscale, undo rotoscale
    14         80          -4.33         0.02         0.02        8      0.495     
    15         85          -4.33         0.01         0.00       11     0.0926     
    16         90          -4.24         0.00         0.01       14       0.45     
    17         95          -4.22         0.00         0.01       17      0.171     
    18        100          -4.19         0.00         0.00       20      0.134     
    19        105          -4.18         0.00         0.00       20       0.11     
    20        110          -4.16         0.00         0.00       20     0.0831     
    21        115          -4.17         0.00         0.00       21      0.052     
    22        120          -4.17         0.00         0.00       21     0.0417     stable
   inf        120          -4.12         0.00         0.01       50     0.0417     finalize
Inference terminated: variational solution stable for options.tol_stable_count fcn evaluations.
Estimated ELBO: -4.120 +/-0.001.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">format_dict</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    &#39;function&#39;: &#39;&lt;function VBMC._init_log_joint.&lt;locals&gt;.log_joint at 0x7f72742bdd30&gt;&#39;,
    &#39;problem_type&#39;: &#39;unconstrained&#39;,
    &#39;iterations&#39;: 22,
    &#39;func_count&#39;: 120,
    &#39;best_iter&#39;: 22,
    &#39;train_set_size&#39;: 109,
    &#39;components&#39;: 50,
    &#39;r_index&#39;: 0.04169208813992187,
    &#39;convergence_status&#39;: &#39;probable&#39;,
    &#39;overhead&#39;: nan,
    &#39;rng_state&#39;: &#39;rng&#39;,
    &#39;algorithm&#39;: &#39;Variational Bayesian Monte Carlo&#39;,
    &#39;version&#39;: &#39;0.1.0&#39;,
    &#39;message&#39;: &#39;Inference terminated: variational solution stable for options.tol_stable_count fcn evaluations.&#39;,
    &#39;elbo&#39;: -4.120462284107793,
    &#39;elbo_sd&#39;: 0.0010921561633801678,
    &#39;success_flag&#39;: True,
}
</pre></div>
</div>
</div>
</div>
<p>With the default budget of function evaluations, we can see that the <code class="docutils literal notranslate"><span class="pre">convergence_status</span></code> is ‘probable’ and the <code class="docutils literal notranslate"><span class="pre">r_index</span></code> is much less than 1, suggesting convergence has been acheived. We can save the result to file and load it at anytime for verification etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;vbmc_test_save.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">vbmc</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;vbmc_test_save.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">vbmc</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">samples</span><span class="p">,</span> <span class="n">components</span> <span class="o">=</span> <span class="n">vbmc</span><span class="o">.</span><span class="n">vp</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># `samples` are samples drawn from the variational posterior.</span>
<span class="c1"># `components` are the index of the mixture components each</span>
<span class="c1">#  sample was drawn from.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 0.30357784 -0.71234015 -0.14057001  0.13733947]
 [ 0.14928481 -0.15568686 -1.29421702 -1.07481781]
 [-0.22150987 -0.33957301 -0.45837818 -0.76437516]
 [-0.6109269  -0.95114658 -0.39232582 -0.19468583]
 [ 0.49805563  0.14956331  0.28175578  1.27601866]]
[ 2 48  2  8 32]
</pre></div>
</div>
</div>
</div>
</section>
<section id="conclusions">
<h2>5. Conclusions<a class="headerlink" href="#conclusions" title="Permalink to this headline">#</a></h2>
<p>In this notebook, we have given a brief overview of PyVBMC’s output diagnostics, and shown how to save and load results and resume optimization from a specific iteration.</p>
<p>In the next notebook, we will illustrate running PyVBMC multiple times in order to validate the results.</p>
</section>
<section id="acknowledgments">
<h2>Acknowledgments<a class="headerlink" href="#acknowledgments" title="Permalink to this headline">#</a></h2>
<p>Work on the PyVBMC package was funded by the <a class="reference external" href="https://fcai.fi/">Finnish Center for Artificial Intelligence FCAI</a>.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="pyvbmc_example_2_inputs_outputs.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">PyVBMC Example 2: Understanding the inputs and the output trace</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pyvbmc_example_4_validation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">PyVBMC Example 4: Multiple runs as validation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2022, Machine and Human Intelligence research group (PI: Luigi Acerbi, University of Helsinki).<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>